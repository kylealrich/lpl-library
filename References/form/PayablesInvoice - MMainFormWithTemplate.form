MMainFormWithTemplate is a Form
    title is "Invoice"
    Layout
        visible when (not RecordExists)
            single column
                TransientInvoiceEntryTemplate
                visible when (not RecordExists)
                    single column
                        visible when (TransientInvoiceEntryTemplate.ServiceContract)
                            InvoiceTypeForMatch
                                label is "InvoiceType"
                        visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                            InvoiceTypeForMatch
                                label is "InvoiceType"
                        visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                            visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                                InvoiceTypeForExpense
                                    label is "InvoiceType"
                        visible when (InvoiceTypeForMatch.MatchPrepayment)
                            MatchPrepaymentMethod
                                label is "PrepaymentMethod"
                                display as required when (MatchPrepaymentMethodRequired)
                                when value changed
                                    refresh MatchPrepaymentMethodRequired
                    single column
                        visible when (IDMDocumentExists)
                            button of "ViewDocument"
                                visible when (IDMDocumentExists)
                                link is external "<DerivedInvoiceURL>"
                                    lazy url retrieval
                                display as link
            visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                single column
                    FirstPurchaseOrder
                        select is MatchPurchaseOrderInvoiceHelperList
                        display as required when (FirstPurchaseOrderRequired)
                        when value changed
                            Vendor =  FirstPurchaseOrder.Vendor
                            refresh FirstPurchaseOrderRequired
                    visible when (POInterfaceInUse)
                        InterfacedPurchaseOrder
                        InterfacedPOCode
                two column distributed
                    TransientAddOnChargeOnly
                        label is "AddOnChargeOnly"
                    CostComponentMatch
                        label is "CostComponentMatch"
                visible when (not InvoiceTypeForMatch.CreditMemo)
                    single column
                        TransientCreateDetails
                            label is "CreateDetails"
            visible when (TransientInvoiceEntryTemplate.ServiceContract)
                two column distributed
                    ServiceContract
                        select is ServiceContractsForInvoicing
                        display as required when (ServiceContractRequired)
                        when value changed
                            Vendor =  ServiceContract.Vendor
                            refresh ServiceContractRequired
                    ServiceContract.Name
                        no label
                        display as text
        visible when (RecordExists)
            single column
                paragraph
                    visible when (RecordExists)
                        InvoiceType
                            display as text
                        paragraph
                            visible when (IDMDocumentExists)
                                button of "ViewDocument"
                                    visible when (IDMDocumentExists)
                                    link is external "<DerivedInvoiceURL>"
                                        lazy url retrieval
                                    display as link
                            visible when (IDMInvoiceSentToVendor)
                                text of "ThisDocumentHasBeenSentToTheVendor"
                paragraph
                    visible when (RecordExists)
                        visible when (InvoiceType.MatchPrepayment)
                            MatchPrepaymentMethod
                                label is "PrepaymentMethod"
        two column distributed
            column1
                Company
                    label is "PayablesCompany"
            column2
                Company.Name
                    no label
                    display as text
        two column distributed
            column1
                ProcessLevel
                    select is NonBillToOnlyPayablesProcessLevels
            column2
                ProcessLevel.Name
                    no label
                    display as text
        two column distributed
            column1
                Location
            column2
                Location.Name
                    no label
                    display as text
        two column distributed
            column1
                Vendor
                    label is "\\Vendor"
                    display as required when (VendorRequired)
                    when value changed
                        refresh VendorRequired
                visible when (VendorIsOnHold)
                    text of "VendorIsOnHold"
                        bold
                        color of red
                visible when (not RecordExists)
                    Vendor.VendorName
                        no label
                        display as text
                visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                    visible when (Vendor.RequireMatchReference)
                        MatchReferenceNumber
                            label is "MatchReference"
                            display as required when (MatchReferenceNumberRequired)
                            when value changed
                                refresh MatchReferenceNumberRequired
                visible when (MatchProcessType.ReceiptMatch)
                    visible when (Vendor.RequireMatchReference)
                        MatchReferenceNumber
                            label is "MatchReference"
                            display as required when (MatchReferenceNumberRequired)
                            when value changed
                                refresh MatchReferenceNumberRequired
            column2
                visible when (RecordExists)
                    button of "<Vendor.VendorName>"
                        visible when (RecordExists)
                        link is MVendor
                        display as link
        single column
            visible when (not InvoiceTypeForMatch.Invoice)
                visible when (not InvoiceTypeForMatch.MatchPrepayment)
                    visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                        visible when (Vendor entered)
                            two column distributed
                                column1
                                    OriginalInvoice
                                        select is VendorNonPerfectMatchInvoicesRel.PayablesOriginalInvoiceList
                                        display as required when (OriginalInvoiceRequired)
                                        when value changed
                                            refresh OriginalInvoiceRequired
                                column2
                                    OriginalInvoice.Invoice
                                        no label
                                        display as text
                    visible when (TransientInvoiceEntryTemplate.ServiceContract)
                        two column distributed
                            column1
                                OriginalInvoice
                                    select is InvoicesForServiceContractRel.PayablesOriginalInvoiceList
                            column2
                                OriginalInvoice.Invoice
                                    no label
                                    display as text
            visible when (not InvoiceType.Prepayment)
                visible when (not InvoiceTypeForExpense.Prepayment)
                    Invoice
                        label is "InvoiceNumber"
                        display as required when (InvoiceNumberRequired)
                        when value changed
                            refresh InvoiceNumberRequired
                visible when (InvoiceTypeForExpense.Prepayment)
                    Invoice
                        label is "PrepaymentNumber"
                        display as required when (InvoiceNumberRequired)
                        when value changed
                            refresh InvoiceNumberRequired
            visible when (InvoiceType.Prepayment)
                Invoice
                    label is "*PrepaymentNumber"
                    display as required when (InvoiceNumberRequired)
                    when value changed
                        refresh InvoiceNumberRequired
            visible when (DisplayInvoiceSuffix)
                Suffix
                    display as text
            visible when (CanceledExpenseInvoice)
                CancelSequence
                    display as text
            Description
                show up to 60 characters
        two column distributed
            column1
                visible when (not InvoiceType.Prepayment)
                    visible when (not InvoiceTypeForExpense.Prepayment)
                        InvoiceDate
                            label is "InvoiceDate"
                            display as required when (InvoiceDateRequired)
                            when value changed
                                refresh InvoiceDateRequired
                    visible when (InvoiceTypeForExpense.Prepayment)
                        InvoiceDate
                            label is "PrepaymentDate"
                            display as required when (InvoiceDateRequired)
                            when value changed
                                refresh InvoiceDateRequired
                visible when (InvoiceType.Prepayment)
                    single column
                        InvoiceDate
                            label is "PrepaymentDate"
                            display as required when (InvoiceDateRequired)
                            when value changed
                                refresh InvoiceDateRequired
            column2
                DueDate
                    label is "\\DueDate"
                    display as required when (DueDateRequired)
                    when value changed
                        refresh DueDateRequired
        visible when (not InvoiceType.Prepayment)
            visible when (not InvoiceTypeForExpense.Prepayment)
                two column distributed
                    column1
                        TermsCode
                            when value changed
                                refresh DueDateRequired
                    column2
                        TermsCode.Desc1
                            no label
                            display as text
                            show up to 13 characters
            single column
                visible when (not InvoiceType.Prepayment)
                    visible when (not InvoiceTypeForExpense.Prepayment)
                        InvoiceAmount.CurrencyAmount
                            label is "InvoiceAmount"
                    visible when (InvoiceTypeForExpense.Prepayment)
                        InvoiceAmount.CurrencyAmount
                            label is "PrepaymentAmount"
            single column
                visible when (InvoiceType.Prepayment)
                    InvoiceAmount.CurrencyAmount
                        label is "PrepaymentAmount"
        two column distributed
            column1
                InvoiceCurrency
                    label is "Currency"
                    show up to 4 characters
            column2
                InvoiceCurrency.Description
                    no label
                    display as text
        single column
            Vendor.CurrentAddressRel.FullAddressDisplay
                display as text
            visible when (Vendor.VATRegistrationInformationEntered)
                paragraph
                    Vendor.VATRegistrationCountry
                        label is "VendorVATRegistration"
                        display as text
                    Vendor.VATRegistrationNumber
                        no label
                        display as text
            paragraph
                PayVendor
                    select is PayVendorSelectRel.VendorSelectSearch
                visible when (DisplayPayVendorLink)
                    button of "<PayVendor.VendorName>"
                        visible when (DisplayPayVendorLink)
                        link is MVendor
                        display as link
            paragraph
                RemitToCode
                    select is APVendorRemitLocationsSelect
                visible when (DisplayRemitToCodeLink)
                    button of "<RemitToCode.VendorName>"
                        visible when (DisplayRemitToCodeLink)
                        link is MRemitToCode
                        display as link
            single column
                visible when (RemitToCode.OnHold)
                    text of "LocationIsOnHold"
                        bold
                        color of red
                visible when (not HasRemitToCode)
                    visible when (HasLocations)
                        text of "<LocationMessage>"
                            bold
                            color of blue
            visible when (not RecordExists)
                RemitToCode.CurrentAddressRel.FullAddressDisplay
                    label is "RemitAddress"
                    display as text
            visible when (RecordExists)
                DerivedFullAddressDisplay
                    label is "RemitAddress"
                    display as text
            visible when (RemitToCode.VATRegistrationInformationEntered)
                two column distributed
                    column1
                        RemitToCode.VATRegistrationCountry
                            label is "RemitLocationVATRegistration"
                            display as text
                    column2
                        RemitToCode.VATRegistrationNumber
                            no label
                            display as text
            visible when (not RecordExists)
                visible when (InvoiceTypeForExpense.CreditMemo)
                    two column distributed
                        column1
                            VendorReturn
                                label is "ReturnNumber"
                                select is VendorReturnsByCompanyVendorRel.VendorReturnList
                        column2
                            VendorReturn.ReferenceNumber
                                no label
                                display as text
        visible when (DisplayAddTaxCodeLink)
            single column
                visible when (DisplayAddTaxCodeLink)
                    visible when (DisplayAddTaxCode)
                        button of "AddTax"
                            visible when (DisplayAddTaxCode)
                            action is ChangeTaxCode
                            display as link
        visible when (not TransientInvoiceEntryTemplate.Basic)
            header2 of "TaxInformation"
                visible when (not TransientInvoiceEntryTemplate.Basic)
                    single column
                        visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                            visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                                TaxableAmount
                                    label is "EnteredTaxableAmount"
                    two column distributed
                        TaxCode
                            select is TaxCodeFilteredList
                            display as required when (TaxCodeRequired)
                            when value changed
                                refresh TaxCodeRequired
                        TaxCode.Description
                            no label
                            display as text
                    single column
                        visible when (not TransientInvoiceEntryTemplate.Basic)
                            visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                                visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                                    TransientLineTax
                    single column
                        visible when (not TransientInvoiceEntryTemplate.Basic)
                            visible when (not TransientInvoiceEntryTemplate.TaxInvoice)
                                TaxAdjustment
                                    when value changed
                                        refresh TaxCodeRequired
                visible when (not TransientInvoiceEntryTemplate.Basic)
                    single column
                        TaxAmount
                            label is "EnteredTaxAmount"
                    two column distributed
                        visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                            TransientTaxCategory
                            TransientTaxCategory.Description
                                no label
                                display as text
                    single column
                        TransientTaxPointDate
        visible when (DisplayTaxSectionMatchInvoice)
            header2 of "TaxInformation"
            visible when (DisplayTaxSectionMatchInvoice)
                single column
                two column distributed
                    TaxCode
                    TaxCode.Description
                        no label
                        display as text
                single column
                    TransientTaxPointDate
                        display as text
            visible when (DisplayTaxSectionMatchInvoice)
                single column
                    TaxAmount
                        label is "EnteredTaxAmount"
                    visible when (DisplayTaxSectionMatchInvoice)
                        visible when (ShortPayCommentExists)
                            text of "<ShortPayMessage>"
                                bold
                                color of blue
                    PayablesInvoiceTaxRel.TotalInvoicedTaxAmount
                        display as text
                    PayablesInvoiceTaxRel.TotalAccruedTaxAmount
                        display as text
                    TaxAdjustment
                        display as text
        visible when (DisplayTaxSection)
            header2 of "TaxInformation"
            two column distributed
                column1
                    visible when (DisplayTaxSection)
                        TaxableAmount
                            label is "EnteredTaxableAmount"
                        visible when (not TaxEntityUsesThirdPartyTax)
                            PayablesInvoiceTaxRel.TotalInvoicedTaxableAmount
                                display as text
                            PayablesInvoiceTaxRel.TotalAccruedTaxableAmount
                                display as text
                        visible when (DisplayTaxSection)
                        visible when (ShortPayCommentExists)
                            text of "<ShortPayMessage>"
                                bold
                                color of blue
                column2
                    visible when (DisplayTaxSection)
                        TaxAmount
                            label is "EnteredTaxAmount"
                        visible when (not TaxEntityUsesThirdPartyTax)
                            PayablesInvoiceTaxRel.TotalInvoicedTaxAmount
                                display as text
                            PayablesInvoiceTaxRel.TotalAccruedTaxAmount
                                display as text
            visible when (RecordExists)
                two column distributed
                    TaxCode
                        display only
                    TaxCode.Description
                        no label
                        display as text
                single column
                    visible when (DisplayChangeTaxCode)
                        button of "Change/\\RemoveTaxCode"
                            visible when (DisplayChangeTaxCode)
                            action is DeleteTaxCode
                            display as link
            visible when (TransientTaxCategory entered)
                two column distributed
                    TransientTaxCategory
                        display as text
                    TransientTaxCategory.Description
                        no label
                        display as text
            visible when (TransientTaxPointDate entered)
                single column
                    TransientTaxPointDate
                        display as text
        visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
            visible when (not PurchaseOrderInvoice)
                visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                    visible when (not MatchProcessType.ServiceContract)
                        visible when (not InvoiceType.Prepayment)
                            visible when (not InvoiceType.PrepaymentCredit)
                                visible when (not InvoiceTypeForExpense.Prepayment)
                                    header3 of "ExpenseDistributionCode"
                                    two column distributed
                                        DistributionCode
                                        DistributionCode.Description
                                            no label
                                            display as text
                                    single column
                                        TransientUnitsAmount
                                        TransientDistCodeAccount
                                            label is "Account"
                                            compact format
        visible when (PurchaseOrderInvoice)
            header2 of "MatchInformation"
            two column distributed
                column1
                    single column
                        visible when (PurchaseOrderInvoice)
                            visible when (HasMultipleMatchPurchaseOrders)
                                MultiplePurchaseOrdersMsg
                                    no label
                                    display as text
                            visible when (HasSingleMatchPurchaseOrder)
                                FirstPurchaseOrder
                                    display as text
                                visible when (MatchProcessType.AOCOnly)
                                    text of "AddOnChargeOnly"
                            single column
                                visible when (IsMemoOnly)
                                    MatchInvoiceReferenceRel.OriginalInvoice
                                        display as text
                                    MatchInvoiceReferenceRel.OriginalInvoice.Invoice
                                        display as text
                column2
                    CostComponentMatch
            two column distributed
                Buyer
                    display as text
                Buyer.Employee.PresentationNameSnapshot
                    no label
                    display as text
        visible when (MatchProcessType.ServiceContract)
            header2 of "Contract"
            visible when (not HasMultipleServiceContracts)
                two column distributed
                    column1
                        ServiceContract
                            select is ServiceContractsForInvoicing
                    column2
                        ServiceContract.Name
                            no label
                            display as text
                    visible when (not IsMatched)
                        button of "AddContract"
                            action is AddContract
                            display as link
            visible when (HasMultipleServiceContracts)
                paragraph
                    DerivedContractList
                        label is "Contracts"
                        display as text
                    visible when (not IsMatched)
                        button of "AddContract"
                            action is AddContract
                            display as link
        visible when (not TransientInvoiceEntryTemplate.Freight)
            header2 of "ProcessingAndApproval"
            visible when (not TransientInvoiceEntryTemplate.Freight)
                two column distributed
                    column1
                        RoutingCategory
                    column2
                        RoutingCategory.Description
                            no label
                            display as text
            visible when (not TransientInvoiceEntryTemplate.Freight)
                two column distributed
                    column1
                        RoutingFinanceTeam
                    column2
                        paragraph
                            RoutingFinanceTeamMember
                                label is "RoutingTeamMember"
                                compact format
                            RoutingFinanceTeamMember.TeamMember.PreferredSimplePresentationName
                                no label
                                display as text
            visible when (not TransientInvoiceEntryTemplate.Freight)
                two column distributed
                    column1
                        AccrualCode
                            show up to 5 characters
                    column2
                        AccrualCode.Description
                            no label
                            display as text
            single column
                visible when (PayGroupEntered)
                    DerivedPayGroup
                        display as text
                visible when (not TransientInvoiceEntryTemplate.Freight)
                    ApprovalCostCenter
                visible when (not TransientInvoiceEntryTemplate.Freight)
                    ApprovalCategory
            visible when (not InvoiceType.Invoice)
                single column
                    OriginalInvoice
                    OriginalInvoice.Invoice
                        no label
                        display as text
            single column
                visible when (not TransientInvoiceEntryTemplate.Freight)
                    DistributionDate
                        label is "PostDate"
            single column
                visible when (not TransientInvoiceEntryTemplate.Freight)
                    ExternalPurchaseOrder
            two column distributed
                column1
                    visible when (not TransientInvoiceEntryTemplate.Freight)
                        ForIntercompanyBilling
                            label is "ForIntercompanyBilling"
                column2
                    visible when (not TransientInvoiceEntryTemplate.Freight)
                        visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                            BypassMatch
                                label is "AllowItemDetail"
                        visible when (PurchaseOrderInvoice)
                            BypassMatch
                                label is "AllowItemDetail"
