ExternalEntityRegistrationForExistingContact is a Form
    title is "Registration"
    disable field options
    disable all actions
    Layout
        paragraph centered
            text of "EnterYourLoginInformationToCompleteYourRegistration"
                header2
        paragraph centered
            DerivedBlankField5
                no label
                display as text
        visible when (not TransientSendVerificationCode)
            paragraph centered
                EmailAddress
                    label is "Email_Address_(User_Name)"
                        left align
                    display as required
                    when value changed
                        LoginName =  EmailAddress
                        refresh DisplayForVerification
                        refresh SupplierSourceIdByEmailExists
                        refresh EmailAddressEntered
                        refresh EmailAddressNotEntered
            visible when (SupplierGroup.RequireEmailConfirmation)
                paragraph centered
                    ConfirmEmailAddress
                        label is "ConfirmEmailAddress"
                            left align
                        display as required
            paragraph centered
                RegistrationPassword
                    label is "Password"
                        left align
                    display as required
                    when value changed
                        refresh RegistrationPasswordEntered
                        refresh RegistrationPasswordNotEntered
            paragraph centered
                RegistrationConfirmPassword
                    label is "ConfirmPassword"
                        left align
                    display as required
                    when value changed
                        refresh RegistrationConfirmPasswordEntered
                        refresh RegistrationConfirmPasswordNotEntered
            paragraph centered
                TransientDisplayPasswordPolicy
                    label is "Show_Password_Requirements"
                    display as switch
            visible when (TransientDisplayPasswordPolicy)
                paragraph centered
                    SupplierGroup.DerivedPasswordPolicy
                        no label
                        display as text
        visible when (TransientSendVerificationCode)
            paragraph centered
                EmailAddress
                    label is "Email_Address_(User_Name)"
                        left align
                    display only
                    display as required
            visible when (SupplierGroup.RequireEmailConfirmation)
                paragraph centered
                    ConfirmEmailAddress
                        label is "ConfirmEmailAddress"
                            left align
                        display only
                        display as required
            paragraph centered
                RegistrationPassword
                    label is "Password"
                        left align
                    display only
                    display as required
            paragraph centered
                RegistrationConfirmPassword
                    label is "ConfirmPassword"
                        left align
                    display only
                    display as required
            paragraph centered
                TransientDisplayPasswordPolicy
                    label is "Show_Password_Requirements"
                    display as switch
            visible when (TransientDisplayPasswordPolicy)
                paragraph centered
                    SupplierGroup.DerivedPasswordPolicy
                        no label
                        display as text
        paragraph centered
            DerivedBlankField5
                no label
                display as text
        visible when (not TransientSendVerificationCode)
            visible when (not DisplayForVerification)
                paragraph centered
                    captcha control
                paragraph centered
                    button of "Submit"
                        action is save
                        is primary
        visible when (not TransientSendVerificationCode)
            visible when (DisplayForVerification)
                paragraph centered
                    button of "Submit"
                        is primary
                        when button pressed
                            TransientStringHolder =  blank
                            refresh RegistrationPasswordsDoNotMatch
                            refresh TransientErrorOccurred
                            refresh DerivedSupplierGroupFromSessionKey
                            refresh DerivedSupplierFromSessionKey
                            refresh DerivedSupplierSourceIdFromSessionKey
                            refresh DerivedEnteredEmailMatchesSessionKey
                            refresh RequiredExistingRegistrationFieldsEntered
                            refresh RequiredExistingRegistrationFieldsNotEntered
                            refresh GivenName
                            refresh FamilyName
                            refresh DerivedVerificationCodeRequiredRegistration
                            refresh TransientUserRegistered
                            refresh EmailAddress
                            refresh TransientSendVerificationCode
                            refresh TransientNextAction
                            refresh TransientUserVerificationId
                            refresh TransientUserIdentity
                            refresh TransientStringHolder
                            TransientSendVerificationCode =  true
                                when (TransientUserRegistered)
                            TransientErrorOccurred =  false
                                when (TransientUserRegistered)
                            TransientErrorOccurred =  false
                                when (RequiredExistingRegistrationFieldsEntered)
                            TransientErrorOccurred =  true
                                when (RequiredExistingRegistrationFieldsNotEntered)
                            TransientErrorOccurred =  true
                                when (not TransientUserRegistered)
                visible when (TransientErrorOccurred)
                    visible when (EmailAddressNotEntered)
                        paragraph centered
                            text of "Registration-EmailAddressIsRequired"
                                header4
                                color of red
                    visible when (RegistrationPasswordNotEntered)
                        paragraph centered
                            text of "Registration-PasswordIsRequired"
                                header4
                                color of red
                    visible when (RegistrationConfirmPasswordNotEntered)
                        paragraph centered
                            text of "Registration-ConfirmPasswordIsRequired"
                                header4
                                color of red
                    visible when (RegistrationPasswordsDoNotMatch)
                        paragraph centered
                            text of "Registration-PasswordsDoNotMatch"
                                header4
                                color of red
        visible when (TransientSendVerificationCode)
            paragraph centered
                text of "PleaseEnterTheVerificationCodeThatWasSentToTheEmailAddressEnteredAbove"
                    bold
                    italics
            visible when (TransientResendVerificationCode)
                paragraph centered
                    text of "WeHaveSentANewVerificationCode"
                        header4
                        color of red
            blank line
            paragraph centered
                TransientVerificationCode
                    label is "EnterVerificationCode"
            paragraph centered
                button of "ResendVerificationCode"
                    display as link
                    is primary
                    when button pressed
                        TransientVerificationCodeResent =  false
                        refresh TransientVerificationCodeResent
                        refresh TransientUserIdentity
                        refresh TransientUserVerificationId
                        refresh DerivedResendVerificationCode
                        refresh TransientResendVerificationCode
            paragraph centered
                button of "ReturnToEntry"
                    display as link
                    is primary
                    when button pressed
                        TransientSendVerificationCode =  false
                        TransientErrorOccurred =  false
                        TransientStringHolder =  blank
            paragraph centered
                DerivedBlankField5
                    no label
                    display as text
            paragraph centered
                captcha control
            paragraph centered
                button of "Submit"
                    action is save
                    is primary
        paragraph centered
            TransientStringHolder
                no label
                color of red
                display as text
        visible when (false)
            LoginName
            GivenName
            FamilyName
            EmailAddressEntered
            RegistrationPasswordEntered
            RegistrationConfirmPasswordEntered
            RegistrationPasswordsDoNotMatch
            DerivedVerificationCodeRequiredRegistration
            TransientSendVerificationCode
            TransientResendVerificationCode
            DerivedResendVerificationCode
            DerivedVerificationCodeRequired
            DisplayForVerification
            TransientUserRegistered
            Supplier
            TransientNextAction
            TransientUserVerificationId
            TransientUserIdentity
            SupplierSourceIdByEmailExists
            TransientErrorOccurred
            TransientStringHolder
            TransientVerificationCodeResent
            DerivedSupplierGroupFromSessionKey
            DerivedSupplierFromSessionKey
            DerivedSupplierSourceIdFromSessionKey
            DerivedEnteredEmailMatchesSessionKey
