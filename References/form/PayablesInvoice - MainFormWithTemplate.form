MainFormWithTemplate is a Form
    title is "Invoice"
    Layout
        visible when (not RecordExists)
            paragraph
                TransientInvoiceEntryTemplate
                    when value changed
                        InvoiceTypeForExpense =  blank
                        InvoiceTypeForMatch =  blank
                        refresh EligibleForVendorNameLookup
                visible when (TransientInvoiceEntryTemplate.ServiceContract)
                    InvoiceTypeForMatch
                        label is "InvoiceType"
                visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                    InvoiceTypeForMatch
                        label is "InvoiceType"
                visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                    visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                        InvoiceTypeForExpense
                            label is "InvoiceType"
                visible when (InvoiceTypeForMatch.MatchPrepayment)
                    MatchPrepaymentMethod
                        label is "PrepaymentMethod"
                        display as required when (MatchPrepaymentMethodRequired)
                        when value changed
                            refresh MatchPrepaymentMethodRequired
                button of "ViewDocument"
                    visible when (IDMDocumentExists)
                    link is external "<DerivedInvoiceURL>"
                        lazy url retrieval
                    display as link
            visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                paragraph
                    FirstPurchaseOrder
                        select is MatchPurchaseOrderInvoiceHelperList
                        display as required when (FirstPurchaseOrderRequired)
                        when value changed
                            Vendor =  FirstPurchaseOrder.Vendor
                            refresh FirstPurchaseOrderRequired
                            refresh DueDateRequired
                    visible when (POInterfaceInUse)
                        InterfacedPurchaseOrder
                        InterfacedPOCode
                paragraph
                    TransientAddOnChargeOnly
                        label is "AddOnChargeOnly"
                    CostComponentMatch
                        label is "CostComponentMatch"
                    visible when (CostComponentMatch)
                        RuleGroup
                    visible when (not InvoiceTypeForMatch.CreditMemo)
                        TransientCreateDetails
                            label is "CreateDetails"
            visible when (TransientInvoiceEntryTemplate.ServiceContract)
                paragraph
                    ServiceContract
                        select is ServiceContractsForInvoicing
                        display as required when (ServiceContractRequired)
                        when value changed
                            Vendor =  ServiceContract.Vendor
                            refresh ServiceContractRequired
                            refresh DueDateRequired
                    ServiceContract.Name
                        no label
                        display as text
        two column distributed
            column1
                visible when (RecordExists)
                    paragraph
                        InvoiceType
                            display as text
                        visible when (InvoiceType.MatchPrepayment)
                            MatchPrepaymentMethod
                                label is "PrepaymentMethod"
                                display as text
                                display as required when (MatchPrepaymentMethodRequired)
                                when value changed
                                    refresh MatchPrepaymentMethodRequired
                        DerivedCompanyNameID
                            label is "Company"
                            display as text
                visible when (not RecordExists)
                    paragraph
                        Company
                            label is "Company"
                            when value changed
                                refresh DueDateRequired
                        Company.Name
                            no label
                            display as text
            column2
                paragraph
                    ProcessLevel
                        select is NonBillToOnlyPayablesProcessLevels
                    ProcessLevel.Name
                        no label
                        display as text
        two column distributed
            column1
                paragraph
                    Vendor
                        select is InvoiceVendorSearch
                        display as required when (VendorRequired)
                        when value changed
                            refresh VendorRequired
                            refresh DueDateRequired
                    visible when (not RecordExists)
                        Vendor.VendorName
                            no label
                            display as text
                        visible when (EligibleForVendorNameLookup)
                            TransientVendorNameSelect
                                label is "VendorNameLookup"
                                show up to 10 characters
                                when value changed
                                    Vendor =  first VendorNameSelectRel.Vendor
                                        when (TransientVendorNameSelect entered)
                                    Vendor =  blank
                                        when (TransientVendorNameSelect not entered)
                    button of "<Vendor.VendorName>"
                        visible when (RecordExists)
                        link is Vendor
                        display as link
                    visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                        visible when (Vendor.RequireMatchReference)
                            MatchReferenceNumber
                                label is "MatchReference"
                                display as required when (MatchReferenceNumberRequired)
                                when value changed
                                    refresh MatchReferenceNumberRequired
                    visible when (MatchProcessType.ReceiptMatch)
                        visible when (Vendor.RequireMatchReference)
                            MatchReferenceNumber
                                label is "MatchReference"
                                display as required when (MatchReferenceNumberRequired)
                                when value changed
                                    refresh MatchReferenceNumberRequired
                visible when (not InvoiceTypeForMatch.Invoice)
                    visible when (not InvoiceTypeForMatch.MatchPrepayment)
                        visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                            visible when (Vendor entered)
                                paragraph
                                    OriginalInvoice
                                        select is VendorNonPerfectMatchInvoicesRel.PayablesOriginalInvoiceList
                                        display as required when (OriginalInvoiceRequired)
                                        when value changed
                                            refresh OriginalInvoiceRequired
                                    OriginalInvoice.Invoice
                                        no label
                                        display as text
                        visible when (TransientInvoiceEntryTemplate.ServiceContract)
                            paragraph
                                OriginalInvoice
                                    select is InvoicesForServiceContractRel.PayablesOriginalInvoiceList
                                OriginalInvoice.Invoice
                                    no label
                                    display as text
                paragraph
                    visible when (not InvoiceType.Prepayment)
                        visible when (not InvoiceTypeForExpense.Prepayment)
                            Invoice
                                label is "InvoiceNumber"
                                display as required when (InvoiceNumberRequired)
                                when value changed
                                    refresh InvoiceNumberRequired
                        visible when (InvoiceTypeForExpense.Prepayment)
                            Invoice
                                label is "PrepaymentNumber"
                                display as required when (InvoiceNumberRequired)
                                when value changed
                                    refresh InvoiceNumberRequired
                    visible when (InvoiceType.Prepayment)
                        Invoice
                            label is "PrepaymentNumber"
                            display as required when (InvoiceNumberRequired)
                            when value changed
                                refresh InvoiceNumberRequired
                    visible when (DisplayInvoiceSuffix)
                        Suffix
                            display as text
                    visible when (CanceledExpenseInvoice)
                        CancelSequence
                            display as text
                paragraph
                    visible when (not InvoiceType.Prepayment)
                        visible when (not InvoiceTypeForExpense.Prepayment)
                            InvoiceDate
                                display as required when (InvoiceDateRequired)
                                when value changed
                                    refresh InvoiceDateRequired
                        visible when (InvoiceTypeForExpense.Prepayment)
                            InvoiceDate
                                label is "PrepaymentDate"
                                display as required when (InvoiceDateRequired)
                                when value changed
                                    refresh InvoiceDateRequired
                    visible when (InvoiceType.Prepayment)
                        InvoiceDate
                            label is "PrepaymentDate"
                            display as required when (InvoiceDateRequired)
                            when value changed
                                refresh InvoiceDateRequired
                    DueDate
                        display as required when (DueDateRequired)
                        when value changed
                            refresh DueDateRequired
                visible when (not InvoiceType.Prepayment)
                    visible when (not InvoiceTypeForExpense.Prepayment)
                        paragraph
                            TermsCode
                                when value changed
                                    refresh DueDateRequired
                            TermsCode.Desc1
                                no label
                                display as text
                paragraph
                    visible when (not InvoiceType.Prepayment)
                        visible when (not InvoiceTypeForExpense.Prepayment)
                            InvoiceAmount.CurrencyAmount
                                label is "InvoiceAmount"
                        visible when (InvoiceTypeForExpense.Prepayment)
                            InvoiceAmount.CurrencyAmount
                                label is "PrepaymentAmount"
                    visible when (InvoiceType.Prepayment)
                        InvoiceAmount.CurrencyAmount
                            label is "PrepaymentAmount"
                    InvoiceCurrency
                        label is "Currency"
                        show up to 4 characters
                    InvoiceCurrency.Description
                        no label
                        display as text
                Description
                button of "ViewExpenseReport"
                    visible when (ViewExpenseManagementLink)
                    link is external "<DerivedExpenseManagementURL>"
                    display as link
            column2
                paragraph
                    PayVendor
                        select is PayVendorSelectRel.VendorSelectSearch
                    button of "<PayVendor.VendorName>"
                        visible when (DisplayPayVendorLink)
                        link is PayVendor
                        display as link
                paragraph
                    RemitToCode
                        select is APVendorRemitLocationsSelect
                        raise red alert when (RequireRemitToAlert)
                            mouse over text is "<RequireRemitToMessage>"
                        raise blue alert when (DisplayLocationMessage)
                            mouse over text is "<LocationMessage>"
                        when value changed
                            refresh DueDateRequired
                    button of "<RemitToCode.VendorName>"
                        visible when (DisplayRemitToCodeLink)
                        link is RemitToCode
                        display as link
                paragraph
                    Vendor.CurrentAddressRel.FullAddressDisplay
                        label is "VendorAddress"
                        display as text
                    visible when (not RecordExists)
                        RemitToCode.CurrentAddressRel.FullAddressDisplay
                            label is "RemitAddress"
                            display as text
                    visible when (RecordExists)
                        DerivedFullAddressDisplay
                            label is "RemitAddress"
                            display as text
                paragraph
                    visible when (not RecordExists)
                        visible when (Vendor.VATRegistrationInformationEntered)
                            Vendor.VATRegistrationNumber
                                display as text
                        visible when (RemitToCode.VATRegistrationInformationEntered)
                            RemitToCode.VATRegistrationNumber
                                display as text
                    visible when (RecordExists)
                        visible when (Vendor.VATRegistrationInformationEntered)
                            DerivedVendorVATRegistrationText
                                display as text
                        visible when (RemitToCode.VATRegistrationInformationEntered)
                            DerivedRemitVATRegistrationText
                                display as text
                paragraph
                    Location
                    Location.Name
                        no label
                        display as text
                visible when (not RecordExists)
                    visible when (InvoiceTypeForExpense.CreditMemo)
                        paragraph
                            VendorReturn
                                label is "ReturnNumber"
                                select is VendorReturnsByCompanyVendorRel.VendorReturnList
                            VendorReturn.ReferenceNumber
                                no label
                                display as text
                visible when (RecordExists)
                    paragraph
                        button of "ViewDocument"
                            visible when (IDMDocumentExists)
                            link is external "<DerivedInvoiceURL>"
                                lazy url retrieval
                            display as link
                        visible when (IDMInvoiceSentToVendor)
                            text of "ThisDocumentHasBeenSentToTheVendor"
        visible when (DisplayAddTaxCodeLink)
            visible when (DisplayAddTaxCode)
                header2 of "TaxInformation"
                single column
                    button of "AddTax"
                        action is ChangeTaxCode
                        is primary
        visible when (not TransientInvoiceEntryTemplate.Basic)
            header2 of "TaxInformation"
            two column distributed
                column1
                    visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                        visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                            TaxableAmount
                                label is "EnteredTaxableAmount"
                    paragraph
                        TaxCode
                            select is TaxCodeFilteredList
                            display as required when (TaxCodeRequired)
                            when value changed
                                refresh TaxCodeRequired
                        TaxCode.Description
                            no label
                            display as text
                    paragraph
                        visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                            visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                                TransientLineTax
                    paragraph
                        visible when (not TransientInvoiceEntryTemplate.TaxInvoice)
                            TaxAdjustment
                                when value changed
                                    refresh TaxCodeRequired
                            visible when (TaxAdjustment.Calculate)
                                TaxableAmount
                                    label is "EnteredTaxableAmount"
                column2
                    paragraph
                        TaxAmount
                            label is "EnteredTaxAmount"
                    paragraph
                        visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
                            TransientTaxCategory
                            TransientTaxCategory.Description
                                no label
                                display as text
                    paragraph
                        TransientTaxPointDate
                    paragraph
                        TransientPointOfTitleTransfer
        visible when (DisplayTaxSectionMatchInvoice)
            header2 of "TaxInformation"
            paragraph
                TaxAmount
                    label is "EnteredTaxAmount"
                    raise blue alert when (ShortPayCommentExists)
                        mouse over text is "<ShortPayMessage>"
                PayablesInvoiceTaxRel.TotalInvoicedTaxAmount
                    display as text
                PayablesInvoiceTaxRel.TotalAccruedTaxAmount
                    display as text
                visible when (TaxAdjustment entered)
                    TaxAdjustment
                        display as text
                    visible when (TaxAdjustment.Calculate)
                        TaxableAmount
                            label is "EnteredTaxableAmount"
                visible when (TransientTaxPointDate entered)
                    TransientTaxPointDate
                        display as text
                TaxCode
                TaxCode.Description
                    no label
                    display as text
                visible when (OneSourceGeneric)
                    visible when (IsNotMatched)
                        TransientPointOfTitleTransfer
                    visible when (IsMatched)
                        DerivedPointOfTitleTransfer
                            display as text
        visible when (DisplayTaxSection)
            header2 of "TaxInformation"
            four column
                column1
                    TaxableAmount
                        label is "EnteredTaxableAmount"
                    TaxAmount
                        label is "EnteredTaxAmount"
                        raise blue alert when (ShortPayCommentExists)
                            mouse over text is "<ShortPayMessage>"
                column2
                    PayablesInvoiceTaxRel.TotalInvoicedTaxableAmount
                        display as text
                    PayablesInvoiceTaxRel.TotalInvoicedTaxAmount
                        display as text
                column3
                    PayablesInvoiceTaxRel.TotalAccruedTaxableAmount
                        display as text
                    PayablesInvoiceTaxRel.TotalAccruedTaxAmount
                        display as text
                column4
                    paragraph
                        TaxCode.DerivedTaxCodeNameID
                            label is "TaxCode"
                            display as text
                        button of "Update/\\RemoveTaxCode"
                            visible when (DisplayChangeTaxCode)
                            action is DeleteTaxCode
                            is primary
                    paragraph
                        visible when (DerivedDisplayTaxSystemTaxAmount entered)
                            display as text
                                DerivedDisplayTaxSystemTaxAmount
                        visible when (TransientTaxPointDate entered)
                            TransientTaxPointDate
                                display as text
                        visible when (TransientTaxCategory entered)
                            display as text
                                paragraph
                                    TransientTaxCategory
                                    TransientTaxCategory.Description
                                        no label
                        visible when (DisplayPointOfTitleTransfer)
                            display as text
                                paragraph
                                    TransientPointOfTitleTransfer
        visible when (not TransientInvoiceEntryTemplate.MatchInvoice)
            visible when (not PurchaseOrderInvoice)
                visible when (not TransientInvoiceEntryTemplate.ServiceContract)
                    visible when (not MatchProcessType.ServiceContract)
                        visible when (not InvoiceType.Prepayment)
                            visible when (not InvoiceType.PrepaymentCredit)
                                visible when (not InvoiceTypeForExpense.Prepayment)
                                    header2 of "ExpenseDistributionCode"
                                    paragraph
                                        DistributionCode
                                            show up to 15 characters
                                        DistributionCode.Description
                                            no label
                                            display as text
                                        TransientUnitsAmount
                                        TransientDistCodeAccount
                                            label is "DistributionCodeAccountOverride"
                                            compact format
        visible when (not TransientInvoiceEntryTemplate.Basic)
            visible when (not TransientInvoiceEntryTemplate.TaxInvoice)
                visible when (not TransientInvoiceEntryTemplate.Freight)
                    header2 of "MatchInformation"
                    paragraph
                        visible when (IsNotMatched)
                            RuleGroup
                        visible when (not IsNotMatched)
                            RuleGroup
                                display as text
                        RuleGroup.Description
                            no label
                            display as text
                        CostComponentMatch
        visible when (DisplayMatchInformation)
            header2 of "MatchInformation"
            two column distributed
                column1
                    paragraph
                        visible when (HasMultipleMatchPurchaseOrders)
                            MultiplePurchaseOrdersMsg
                                no label
                                display as text
                                raise yellow alert when (ShowUnmatchedNoReceiptsInPoolAlert)
                                    mouse over text is "InvoiceMissingReceipt"
                        visible when (HasSingleMatchPurchaseOrder)
                            FirstPurchaseOrder
                                display as text
                                raise yellow alert when (ShowUnmatchedNoReceiptsInPoolAlert)
                                    mouse over text is "InvoiceMissingReceipt"
                            visible when (MatchProcessType.AOCOnly)
                                text of "AddOnChargeOnly"
                        visible when (ShowUnmatchedNoReceiptsInPoolAlert)
                            button of "NotifyBuyerNoReceiptInPool"
                                action is EmailNoReceiptInPool
                        visible when (IsMemoOnly)
                            display as text
                                paragraph
                                    MatchInvoiceReferenceRel.OriginalInvoice
                                    MatchInvoiceReferenceRel.OriginalInvoice.Invoice
                    paragraph
                        visible when (IsNotMatched)
                            RuleGroup
                        visible when (not IsNotMatched)
                            RuleGroup
                                display as text
                        RuleGroup.Description
                            no label
                            display as text
                        CostComponentMatch
                column2
                    display as text
                        visible when (Buyer entered)
                            paragraph
                                Buyer.Employee.PresentationNameSnapshot
                                    label is "Buyer"
                                button of "<Buyer.Employee.EmployeeWorkEmailAddress>"
                                    link is "mailto:<Buyer.Employee.EmployeeWorkEmailAddress>"
                                    display as link
                                button of "<Buyer.Employee.EmployeeWorkTelephone>"
                                    link is "tel:<Buyer.Employee.EmployeeWorkTelephone>"
                                    display as link
                        paragraph
                            MatchProcessType
                            MatchStatus
                            MatchLevel
                            MatchDate
                            MatchedFrom
        visible when (MatchProcessType.ServiceContract)
            header2 of "Contract"
            visible when (not HasMultipleServiceContracts)
                paragraph
                    ServiceContract
                        select is ServiceContractsForInvoicing
                    ServiceContract.Name
                        no label
                        display as text
                    visible when (not IsMatched)
                        button of "AddContract"
                            action is AddContract
                            display as link
            visible when (HasMultipleServiceContracts)
                paragraph
                    DerivedContractList
                        label is "Contracts"
                        display as text
                    visible when (not IsMatched)
                        button of "AddContract"
                            action is AddContract
                            display as link
        visible when (not TransientInvoiceEntryTemplate.Freight)
            header2 of "Processing_andApproval"
            two column distributed
                paragraph
                    RoutingCategory
                    RoutingCategory.Description
                        no label
                        display as text
                paragraph
                    ApprovalCostCenter
                    ApprovalCategory
            two column distributed
                column1
                    paragraph
                        RoutingFinanceTeam
                        RoutingFinanceTeamMember
                            label is "RoutingTeamMember"
                            compact format
                        RoutingFinanceTeamMember.TeamMember.PreferredSimplePresentationName
                            no label
                            display as text
                column2
                    paragraph
                        ExternalPurchaseOrder
                        visible when (not InvoiceType.Invoice)
                            OriginalInvoice
                            OriginalInvoice.Invoice
                                no label
                                display as text
            two column distributed
                column1
                    paragraph
                        DistributionDate
                            label is "PostDate"
                        ForIntercompanyBilling
                            label is "ForIntercompanyBilling"
                column2
                    paragraph
                        visible when (TransientInvoiceEntryTemplate.MatchInvoice)
                            BypassMatch
                                label is "AllowItemDetail"
                        visible when (PurchaseOrderInvoice)
                            BypassMatch
                                label is "AllowItemDetail"
